{% extends "base.html" %}

{% block title %}Analytics{% endblock %}

{% block content %}
<!-- Page Header -->
<div style="margin-bottom: 32px;">
    <h1 style="font-size: 48px; font-weight: 700; margin-bottom: 8px;">Analytics</h1>
    <p class="text-secondary">Track your revenue pipeline and conversion metrics</p>
</div>

<!-- Revenue Stats -->
<div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 32px;">
    <div class="card" style="padding: 20px;">
        <div class="text-muted" style="font-size: 13px; margin-bottom: 8px;">Pipeline Value</div>
        <div style="font-size: 28px; font-weight: 700; color: var(--success);">${{ "{:,.0f}".format(revenue.weighted_pipeline_value) }}</div>
    </div>
    <div class="card" style="padding: 20px;">
        <div class="text-muted" style="font-size: 13px; margin-bottom: 8px;">Target Salary</div>
        <div style="font-size: 28px; font-weight: 700;">${{ "{:,.0f}".format(revenue.target_salary) }}</div>
    </div>
    <div class="card" style="padding: 20px;">
        <div class="text-muted" style="font-size: 13px; margin-bottom: 8px;">Progress</div>
        <div style="font-size: 28px; font-weight: 700; color: var(--warning);">{{ "{:.0f}".format(revenue.progress_to_target) }}%</div>
    </div>
    <div class="card" style="padding: 20px;">
        <div class="text-muted" style="font-size: 13px; margin-bottom: 8px;">Offers</div>
        <div style="font-size: 28px; font-weight: 700; color: var(--brand);">{{ revenue.offers }}</div>
    </div>
</div>

<!-- Progress Bar -->
<div class="card mb-4">
    <div class="card-header">
        <div class="card-title">Progress to ${{ "{:,.0f}".format(revenue.target_salary) }} Goal</div>
    </div>
    <div class="progress-bar" style="height: 12px;">
        <div class="progress-fill" style="width: {{ revenue.progress_to_target }}%;"></div>
    </div>
</div>

<!-- Two Columns -->
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
    <!-- Conversion Funnel -->
    <div class="card">
        <div class="card-header">
            <div class="card-title">Conversion Funnel</div>
        </div>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
            <div style="text-align: center; padding: 24px; background: var(--bg-elevated); border-radius: 8px;">
                <div style="font-size: 32px; font-weight: 700; color: var(--brand); margin-bottom: 8px;">{{ "{:.1f}".format(funnel.application_to_screen) }}%</div>
                <div class="text-muted" style="font-size: 13px;">App ‚Üí Screen</div>
            </div>
            <div style="text-align: center; padding: 24px; background: var(--bg-elevated); border-radius: 8px;">
                <div style="font-size: 32px; font-weight: 700; color: var(--info); margin-bottom: 8px;">{{ "{:.1f}".format(funnel.screen_to_interview) }}%</div>
                <div class="text-muted" style="font-size: 13px;">Screen ‚Üí Interview</div>
            </div>
            <div style="text-align: center; padding: 24px; background: var(--bg-elevated); border-radius: 8px;">
                <div style="font-size: 32px; font-weight: 700; color: var(--warning); margin-bottom: 8px;">{{ "{:.1f}".format(funnel.interview_to_offer) }}%</div>
                <div class="text-muted" style="font-size: 13px;">Interview ‚Üí Offer</div>
            </div>
            <div style="text-align: center; padding: 24px; background: var(--bg-elevated); border-radius: 8px;">
                <div style="font-size: 32px; font-weight: 700; color: var(--success); margin-bottom: 8px;">{{ "{:.1f}".format(funnel.overall_conversion) }}%</div>
                <div class="text-muted" style="font-size: 13px;">Overall</div>
            </div>
        </div>
    </div>
    
    <!-- Activity -->
    <div class="card">
        <div class="card-header">
            <div class="card-title">This Week</div>
        </div>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
            <div style="text-align: center; padding: 20px; background: var(--bg-elevated); border-radius: 8px;">
                <div style="font-size: 32px; font-weight: 700; color: {% if activity.applications_this_week >= 5 %}var(--success){% else %}var(--warning){% endif %}; margin-bottom: 8px;">{{ activity.applications_this_week }}</div>
                <div class="text-muted" style="font-size: 13px;">Applications</div>
            </div>
            <div style="text-align: center; padding: 20px; background: var(--bg-elevated); border-radius: 8px;">
                <div style="font-size: 32px; font-weight: 700; color: {% if activity.avg_ats_score >= 80 %}var(--success){% else %}var(--warning){% endif %}; margin-bottom: 8px;">{{ "{:.0f}".format(activity.avg_ats_score) }}</div>
                <div class="text-muted" style="font-size: 13px;">Avg ATS</div>
            </div>
            <div style="text-align: center; padding: 20px; background: var(--bg-elevated); border-radius: 8px;">
                <div style="font-size: 32px; font-weight: 700; color: var(--brand); margin-bottom: 8px;">{{ activity.applications_this_month }}</div>
                <div class="text-muted" style="font-size: 13px;">This Month</div>
            </div>
        </div>
    </div>
</div>

<!-- Recommendations -->
<div class="card mt-4">
    <div class="card-header">
        <div class="card-title"><i class="fas fa-lightbulb"></i> Recommendations</div>
    </div>
    {% if activity.applications_this_week < 5 %}
    <div style="padding: 16px; background: rgba(234, 179, 8, 0.1); border-left: 4px solid var(--warning); border-radius: 8px; margin-bottom: 12px;">
        <strong style="color: var(--warning);">Low Volume:</strong> Only {{ activity.applications_this_week }} apps this week. Target: 5+
    </div>
    {% endif %}
    
    {% if activity.avg_ats_score < 80 %}
    <div style="padding: 16px; background: rgba(234, 179, 8, 0.1); border-left: 4px solid var(--warning); border-radius: 8px; margin-bottom: 12px;">
        <strong style="color: var(--warning);">ATS Scores:</strong> Average {{ "{:.0f}".format(activity.avg_ats_score) }}/100. Review CV optimization.
    </div>
    {% endif %}
    
    {% if revenue.offers > 0 %}
    <div style="padding: 16px; background: rgba(34, 197, 94, 0.1); border-left: 4px solid var(--success); border-radius: 8px;">
        <strong style="color: var(--success);">Offers:</strong> You have {{ revenue.offers }} offer(s)! Negotiate aggressively.
    </div>
    {% endif %}
</div>

<!-- FEATURE: Weekly Report Email Section -->
<div class="card mt-4" style="border-left: 4px solid #3B82F6;">
    <div class="card-header">
        <div class="card-title">
            <i class="fas fa-envelope" style="color: #3B82F6;"></i> Weekly Report Email
        </div>
        <button class="btn btn-primary btn-sm" onclick="generateWeeklyReport()">
            <i class="fas fa-paper-plane"></i> Generate Report
        </button>
    </div>
    <div style="padding: 20px;">
        <p class="text-secondary" style="margin-bottom: 20px;">
            Auto-generated Sunday night summary for tracking your job search progress
        </p>
        
        <!-- Preview -->
        <div id="weeklyReportPreview" style="display: none;">
            <div style="padding: 20px; background: var(--bg-elevated); border-radius: 8px; margin-bottom: 20px;">
                <div style="font-weight: 600; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid var(--border-subtle);">
                    Subject: Weekly Progress Report: Feb 9 - Feb 15
                </div>
                <div style="font-family: monospace; font-size: 13px; white-space: pre-wrap; color: var(--text-secondary);">
Hi Ahmed,

Here's your weekly progress report for the week of February 9 - February 15.

==================================================
üìä PIPELINE OVERVIEW
==================================================

üéØ Target Salary: $200,000
üí∞ Pipeline Value: $85,000 (43% of target)
üìã Active Offers: 0
üíµ Average Offer: $0

==================================================
üìà CONVERSION METRICS
==================================================

üì® Application ‚Üí Interview: 18.5%
üé§ Interview ‚Üí Offer: 33.3%
üìä Overall Conversion: 2.1%
üìè Industry Benchmark: Industry avg: 2-5%

==================================================
‚ö° ACTIVITY TRACKER
==================================================

üìù This Week: 4 applications
üìÖ This Month: 12 applications
üéØ Weekly Target: 5
üìà Status: ‚ö†Ô∏è NEEDS ATTENTION
üìä Average ATS Score: 82

==================================================
üí° RECOMMENDATIONS
==================================================

üî¥ LOW VOLUME: Only 4 apps this week. Target: 5+
üü¢ ATS SCORES: Avg 82/100. Well optimized.
üü° CONVERSION: Low response rate. Consider network warm intros.

==================================================
üìÖ NEXT WEEK FOCUS
==================================================

1. Increase application volume to 5+/week
2. Focus on network warm intros for better conversion
3. Schedule mock interviews to improve close rate
4. Target $200,000+ roles

---
Generated: 2026-02-15 10:00
                </div>
            </div>
        </div>
        
        <!-- Quick Stats -->
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px;">
            <div style="padding: 16px; background: var(--bg-elevated); border-radius: 8px; text-align: center;">
                <div style="font-size: 24px; font-weight: 700;">4</div>
                <div class="text-muted" style="font-size: 12px;">Apps This Week</div>
            </div>
            <div style="padding: 16px; background: var(--bg-elevated); border-radius: 8px; text-align: center;">
                <div style="font-size: 24px; font-weight: 700;">12</div>
                <div class="text-muted" style="font-size: 12px;">Apps This Month</div>
            </div>
            <div style="padding: 16px; background: var(--bg-elevated); border-radius: 8px; text-align: center;">
                <div style="font-size: 24px; font-weight: 700;">82%</div>
                <div class="text-muted" style="font-size: 12px;">Avg ATS Score</div>
            </div>
            <div style="padding: 16px; background: var(--bg-elevated); border-radius: 8px; text-align: center;">
                <div style="font-size: 24px; font-weight: 700; color: var(--warning);">43%</div>
                <div class="text-muted" style="font-size: 12px;">Pipeline Coverage</div>
            </div>
        </div>
    </div>
</div>

<!-- FEATURE: Goal Setting Dashboard Section -->
<div class="card mt-4" style="border-left: 4px solid #10B981;">
    <div class="card-header">
        <div class="card-title">
            <i class="fas fa-bullseye" style="color: #10B981;"></i> Goal Setting Dashboard
        </div>
    </div>
    <div style="padding: 20px;">
        <p class="text-secondary" style="margin-bottom: 20px;">
            Set and track monthly targets with progress visualization
        </p>
        
        <!-- Goals -->
        <div style="display: grid; gap: 16px;">
            <div style="padding: 16px; background: var(--bg-elevated); border-radius: 8px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                    <div>
                        <strong>Weekly Applications</strong>
                        <div class="text-muted" style="font-size: 13px;">Target: 5 per week</div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 24px; font-weight: 700;">4/5</div>
                        <div class="text-muted" style="font-size: 12px;">80% complete</div>
                    </div>
                </div>
                <div class="progress-bar" style="height: 8px;">
                    <div class="progress-fill" style="width: 80%; background: var(--warning);"></div>
                </div>
            </div>
            
            <div style="padding: 16px; background: var(--bg-elevated); border-radius: 8px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                    <div>
                        <strong>Monthly Interviews</strong>
                        <div class="text-muted" style="font-size: 13px;">Target: 3 per month</div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 24px; font-weight: 700;">2/3</div>
                        <div class="text-muted" style="font-size: 12px;">67% complete</div>
                    </div>
                </div>
                <div class="progress-bar" style="height: 8px;">
                    <div class="progress-fill" style="width: 67%;"></div>
                </div>
            </div>
            
            <div style="padding: 16px; background: var(--bg-elevated); border-radius: 8px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                    <div>
                        <strong>Network Outreach</strong>
                        <div class="text-muted" style="font-size: 13px;">Target: 10 per week</div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 24px; font-weight: 700;">7/10</div>
                        <div class="text-muted" style="font-size: 12px;">70% complete</div>
                    </div>
                </div>
                <div class="progress-bar" style="height: 8px;">
                    <div class="progress-fill" style="width: 70%;"></div>
                </div>
            </div>
            
            <div style="padding: 16px; background: var(--bg-elevated); border-radius: 8px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                    <div>
                        <strong>Salary Target</strong>
                        <div class="text-muted" style="font-size: 13px;">Target: $200,000</div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 24px; font-weight: 700;">$0/$200K</div>
                        <div class="text-muted" style="font-size: 12px;">0% complete</div>
                    </div>
                </div>
                <div class="progress-bar" style="height: 8px;">
                    <div class="progress-fill" style="width: 0%; background: var(--text-muted);"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function generateWeeklyReport() {
    const preview = document.getElementById('weeklyReportPreview');
    if (preview.style.display === 'none') {
        preview.style.display = 'block';
    } else {
        preview.style.display = 'none';
    }
}
</script>
{% endblock %}
