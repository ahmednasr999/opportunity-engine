{% extends "base.html" %}

{% block title %}CV Optimizer{% endblock %}

{% block content %}
<!-- Page Header -->
<div style="margin-bottom: 32px;">
    <h1 style="font-size: 48px; font-weight: 700; margin-bottom: 8px;">CV Optimizer</h1>
    <p class="text-secondary">Paste a job description to generate a tailored CV with ATS scoring</p>
</div>

{% if result %}
<!-- Results -->
<div style="display: grid; grid-template-columns: 1fr 1.5fr; gap: 24px;">
    <!-- Left Column: Scores -->
    <div style="display: flex; flex-direction: column; gap: 24px;">
        <!-- ATS Score Card -->
        <div class="card card-status-{% if result.ats_score >= 90 %}live{% elif result.ats_score >= 75 %}building{% else %}ideas{% endif %}" style="text-align: center; padding: 32px;">
            <div style="font-size: 72px; font-weight: 800; margin-bottom: 8px; color: {% if result.ats_score >= 90 %}var(--success){% elif result.ats_score >= 75 %}var(--brand){% else %}var(--warning){% endif %};">
                {{ result.ats_score }}
            </div>
            <div class="text-secondary" style="font-size: 18px; margin-bottom: 16px;">/ 100</div>
            <span class="badge {% if result.ats_score >= 90 %}badge-green{% elif result.ats_score >= 75 %}badge-blue{% else %}badge-yellow{% endif %}">
                {% if result.ats_score >= 90 %}Excellent{% elif result.ats_score >= 75 %}Good{% else %}Needs Work{% endif %}
            </span>
        </div>
        
        <!-- Match Breakdown -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">Match Breakdown</div>
            </div>
            {% for category, score in result.match_analysis.items() %}
                <div style="margin-bottom: 16px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span class="text-secondary">{{ category.replace('_', ' ').title() }}</span>
                        <span style="font-weight: 600;">{{ score }}/30</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: {{ (score / 30 * 100) }}%;"></div>
                    </div>
                </div>
            {% endfor %}
        </div>
        
        <!-- Suggestions -->
        {% if result.suggestions %}
        <div class="card" style="border-color: var(--warning);">
            <div class="card-header">
                <div class="card-title" style="color: var(--warning);">
                    <i class="fas fa-lightbulb"></i> Improvements
                </div>
            </div>
            {% for suggestion in result.suggestions[:3] %}
                <div style="padding: 12px; background: var(--bg-elevated); border-radius: 8px; margin-bottom: 8px; font-size: 13px; border-left: 3px solid var(--warning);">
                    {{ suggestion }}
                </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    
    <!-- Right Column: Generated CV -->
    <div class="card" style="display: flex; flex-direction: column;">
        <div class="card-header">
            <div class="card-title">Generated CV</div>
            <button onclick="copyCV()" class="btn btn-secondary btn-sm">
                <i class="fas fa-copy"></i> Copy
            </button>
        </div>
        <pre id="cv-text" style="flex: 1; background: var(--bg-elevated); padding: 24px; border-radius: 8px; overflow: auto; font-family: 'Fira Code', monospace; font-size: 13px; line-height: 1.8; color: var(--text-secondary); white-space: pre-wrap;">{{ result.cv_text }}</pre>
    </div>
</div>

<div class="mt-4" style="display: flex; gap: 12px;">
    <a href="/cv-optimizer" class="btn btn-secondary btn-md">
        <i class="fas fa-arrow-left"></i> Process Another
    </a>
    <a href="/job-tracker" class="btn btn-primary btn-md">
        <i class="fas fa-tasks"></i> View in Tracker
    </a>
</div>

<script>
function copyCV() {
    const text = document.getElementById('cv-text').innerText;
    navigator.clipboard.writeText(text).then(() => {
        alert('CV copied to clipboard!');
    });
}
</script>

{% else %}
<!-- Input Form -->
<div class="card" style="max-width: 800px;">
    <div class="card-header">
        <div class="card-title">Job Details</div>
    </div>
    <form method="POST" action="/cv-optimizer">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
            <div class="form-group">
                <label class="form-label">Company Name</label>
                <input type="text" name="company" class="form-input" placeholder="e.g., Saudi German Hospital" required>
            </div>
            <div class="form-group">
                <label class="form-label">Job Title</label>
                <input type="text" name="title" class="form-input" placeholder="e.g., VP Digital Transformation" required>
            </div>
        </div>
        
        <div class="form-group">
            <label class="form-label">Job Description</label>
            <textarea name="job_text" class="form-textarea" placeholder="Paste the full job description here..." required></textarea>
        </div>
        
        <button type="submit" class="btn btn-primary btn-lg" style="width: 100%;">
            <i class="fas fa-magic"></i> Generate Tailored CV
        </button>
    </form>
</div>

<!-- Tips -->
<div class="card mt-4" style="max-width: 800px;">
    <div class="card-header">
        <div class="card-title"><i class="fas fa-info-circle"></i> Tips</div>
    </div>
    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
        <div style="padding: 16px; background: var(--bg-elevated); border-radius: 8px;">
            <i class="fas fa-check" style="color: var(--success); margin-right: 8px;"></i>
            Include full job description for best matching
        </div>
        <div style="padding: 16px; background: var(--bg-elevated); border-radius: 8px;">
            <i class="fas fa-check" style="color: var(--success); margin-right: 8px;"></i>
            Target ATS score: 90+ for best results
        </div>
        <div style="padding: 16px; background: var(--bg-elevated); border-radius: 8px;">
            <i class="fas fa-check" style="color: var(--success); margin-right: 8px;"></i>
            Add missing keywords to your profile
        </div>
        <div style="padding: 16px; background: var(--bg-elevated); border-radius: 8px;">
            <i class="fas fa-check" style="color: var(--success); margin-right: 8px;"></i>
            Always review before submitting
        </div>
    </div>
</div>
{% endif %}
{% endblock %}
