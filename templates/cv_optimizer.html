{% extends "base.html" %}

{% block title %}CV Optimizer{% endblock %}

{% block content %}
<!-- Page Header -->
<div style="margin-bottom: 32px;">
    <h1 style="font-size: 48px; font-weight: 700; margin-bottom: 8px;">CV Optimizer</h1>
    <p class="text-secondary">Generate tailored CVs with ATS scoring and professional PDF export</p>
</div>

{% if result %}
<!-- Results -->
<div style="display: grid; grid-template-columns: 1fr 1.5fr; gap: 24px;">
    <!-- Left Column: Scores -->
    <div style="display: flex; flex-direction: column; gap: 24px;">
        <!-- ATS Score Card -->
        <div class="card card-status-{% if result.ats_score >= 90 %}live{% elif result.ats_score >= 75 %}building{% else %}ideas{% endif %}" style="text-align: center; padding: 32px;">
            <div style="font-size: 72px; font-weight: 800; margin-bottom: 8px; color: {% if result.ats_score >= 90 %}var(--success){% elif result.ats_score >= 75 %}var(--brand){% else %}var(--warning){% endif %};">
                {{ result.ats_score }}
            </div>
            <div class="text-secondary" style="font-size: 18px; margin-bottom: 16px;">/ 100</div>
            <span class="badge {% if result.ats_score >= 90 %}badge-green{% elif result.ats_score >= 75 %}badge-blue{% else %}badge-yellow{% endif %}">
                {% if result.ats_score >= 90 %}Excellent{% elif result.ats_score >= 75 %}Good{% else %}Needs Work{% endif %}
            </span>
        </div>
        
        <!-- Match Breakdown -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">Match Breakdown</div>
            </div>
            {% for category, score in result.match_analysis.items() %}
                <div style="margin-bottom: 16px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span class="text-secondary">{{ category.replace('_', ' ').title() }}</span>
                        <span style="font-weight: 600;">{{ score }}/30</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: {{ (score / 30 * 100) }}%;"></div>
                    </div>
                </div>
            {% endfor %}
        </div>
        
        <!-- Suggestions -->
        {% if result.suggestions %}
        <div class="card" style="border-color: var(--warning);">
            <div class="card-header">
                <div class="card-title" style="color: var(--warning);">
                    <i class="fas fa-lightbulb"></i> Improvements
                </div>
            </div>
            {% for suggestion in result.suggestions[:3] %}
                <div style="padding: 12px; background: var(--bg-elevated); border-radius: 8px; margin-bottom: 8px; font-size: 13px; border-left: 3px solid var(--warning);">
                    {{ suggestion }}
                </div>
            {% endfor %}
        </div>
        {% endif %}
        
        <!-- Download Options -->
        <div class="card" style="border-color: var(--success);">
            <div class="card-header">
                <div class="card-title" style="color: var(--success);">
                    <i class="fas fa-download"></i> Export CV
                </div>
            </div>
            <div style="display: flex; flex-direction: column; gap: 12px;">
                {% if result.pdf_filename %}
                <a href="/cv-optimizer/view-cv/{{ result.pdf_filename }}" target="_blank" class="btn btn-success btn-lg" style="text-align: center;">
                    <i class="fas fa-file-pdf"></i> View Print-Ready CV
                </a>
                {% endif %}
                <button onclick="copyCV()" class="btn btn-secondary btn-lg">
                    <i class="fas fa-copy"></i> Copy Text Version
                </button>
                <div class="text-muted" style="font-size: 12px; text-align: center; margin-top: 8px;">
                    <i class="fas fa-info-circle"></i> PDF opens in browser. Use Ctrl+P to save as PDF.
                </div>
            </div>
        </div>
    </div>
    
    <!-- Right Column: Generated CV -->
    <div class="card" style="display: flex; flex-direction: column;">
        <div class="card-header">
            <div class="card-title">Generated CV</div>
        </div>
        <pre id="cv-text" style="flex: 1; background: var(--bg-elevated); padding: 24px; border-radius: 8px; overflow: auto; font-family: 'Fira Code', monospace; font-size: 13px; line-height: 1.8; color: var(--text-secondary); white-space: pre-wrap;">{{ result.cv_text }}</pre>
    </div>
</div>

<div class="mt-4" style="display: flex; gap: 12px;">
    <a href="/cv-optimizer" class="btn btn-secondary btn-md">
        <i class="fas fa-arrow-left"></i> Process Another
    </a>
    <a href="/job-tracker" class="btn btn-primary btn-md">
        <i class="fas fa-tasks"></i> View in Tracker
    </a>
</div>

<script>
function copyCV() {
    const text = document.getElementById('cv-text').innerText;
    navigator.clipboard.writeText(text).then(() => {
        alert('CV copied to clipboard!');
    });
}
</script>

{% else %}
<!-- LinkedIn Import -->
<div class="card mb-4" style="border-color: var(--brand);">
    <div class="card-header">
        <div class="card-title" style="color: var(--brand);">
            <i class="fab fa-linkedin"></i> Import from LinkedIn
        </div>
    </div>
    <form method="POST" action="/cv-optimizer/import-linkedin">
        <div style="display: flex; gap: 16px; align-items: end;">
            <div class="form-group" style="flex: 1;">
                <label class="form-label">LinkedIn Job URL</label>
                <input type="url" name="url" class="form-input" placeholder="https://www.linkedin.com/jobs/view/..." 
                       value="{% if linkedin_data %}{{ linkedin_data.url }}{% endif %}">
            </div>
            <div class="form-group">
                <button type="submit" class="btn btn-primary btn-md">
                    <i class="fas fa-import"></i> Import
                </button>
            </div>
        </div>
        <div class="text-muted" style="font-size: 12px; margin-top: 8px;">
            <i class="fas fa-info-circle"></i> Paste a LinkedIn job posting URL to auto-fill details (manual confirmation required)
        </div>
    </form>
    
    {% if linkedin_data %}
    <div style="margin-top: 20px; padding: 16px; background: rgba(34, 197, 94, 0.1); border: 1px solid var(--success); border-radius: 8px;">
        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
            <i class="fas fa-check-circle" style="color: var(--success); font-size: 20px;"></i>
            <span style="font-weight: 600;">LinkedIn URL imported!</span>
        </div>
        {% if linkedin_data.title %}
        <div style="margin-bottom: 8px; padding: 8px; background: var(--bg-card); border-radius: 4px;">
            <strong>Detected Title:</strong> {{ linkedin_data.title }}
        </div>
        {% endif %}
        {% if linkedin_data.company %}
        <div style="margin-bottom: 8px; padding: 8px; background: var(--bg-card); border-radius: 4px;">
            <strong>Detected Company:</strong> {{ linkedin_data.company }}
        </div>
        {% endif %}
        <div class="text-muted" style="font-size: 12px; margin-top: 12px;">
            <i class="fas fa-info-circle"></i> LinkedIn blocks full scraping. Please fill in the details below manually.
        </div>
    </div>
    {% endif %}
</div>

<!-- Input Form -->
<div class="card" style="max-width: 800px;">
    <div class="card-header">
        <div class="card-title">Job Details</div>
    </div>
    <form method="POST" action="/cv-optimizer">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
            <div class="form-group">
                <label class="form-label">Company Name</label>
                <input type="text" name="company" class="form-input" placeholder="e.g., Saudi German Hospital" 
                       value="{% if linkedin_data %}{{ linkedin_data.company }}{% endif %}" required>
            </div>
            <div class="form-group">
                <label class="form-label">Job Title</label>
                <input type="text" name="title" class="form-input" placeholder="e.g., VP Digital Transformation" 
                       value="{% if linkedin_data %}{{ linkedin_data.title }}{% endif %}" required>
            </div>
        </div>
        
        <div class="form-group">
            <label class="form-label">Job Description</label>
            <textarea name="job_text" class="form-textarea" placeholder="Paste the full job description here..." required></textarea>
        </div>
        
        <button type="submit" class="btn btn-primary btn-lg" style="width: 100%;">
            <i class="fas fa-magic"></i> Generate Tailored CV + PDF
        </button>
    </form>
</div>

<!-- Tips -->
<div class="card mt-4" style="max-width: 800px;">
    <div class="card-header">
        <div class="card-title"><i class="fas fa-info-circle"></i> Pro Tips</div>
    </div>
    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
        <div style="padding: 16px; background: var(--bg-elevated); border-radius: 8px;">
            <i class="fas fa-check" style="color: var(--success); margin-right: 8px;"></i>
            Include full job description for best matching
        </div>
        <div style="padding: 16px; background: var(--bg-elevated); border-radius: 8px;">
            <i class="fas fa-check" style="color: var(--success); margin-right: 8px;"></i>
            Target ATS score: 90+ for best results
        </div>
        <div style="padding: 16px; background: var(--bg-elevated); border-radius: 8px;">
            <i class="fas fa-check" style="color: var(--success); margin-right: 8px;"></i>
            Download PDF for professional formatting
        </div>
        <div style="padding: 16px; background: var(--bg-elevated); border-radius: 8px;">
            <i class="fas fa-check" style="color: var(--success); margin-right: 8px;"></i>
            Copy text version for ATS-friendly applications
        </div>
    </div>
</div>
{% endif %}
{% endblock %}
